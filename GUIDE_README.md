# Gradjanski Zahtevi - Developer Onboarding Guide

Welcome to the `gradjanskizahtevi` project! This guide provides essential information for new developers joining the team.

## Project Overview

This project is a web application built to [**TODO: Briefly describe the purpose of the application - what does it do? e.g., manage citizen requests, track issues, etc.**].

## Tech Stack

The application utilizes the following technologies:

*   **Frontend:**
    *   Framework: [React](https://react.dev/) with [TypeScript](https://www.typescriptlang.org/)
    *   Build Tool: [Vite](https://vitejs.dev/)
    *   UI Library: [shadcn/ui](https://ui.shadcn.com/) (built on [Radix UI](https://www.radix-ui.com/) and styled with [Tailwind CSS](https://tailwindcss.com/))
    *   Routing: [React Router](https://reactrouter.com/)
    *   State Management/Data Fetching: [Tanstack Query](https://tanstack.com/query/latest)
    *   Forms: [React Hook Form](https://react-hook-form.com/) with [Zod](https://zod.dev/) for validation
*   **Backend:**
    *   Platform: [Supabase](https://supabase.com/)
        *   Database: PostgreSQL
        *   Auth: Supabase Auth (integrated with Clerk)
        *   [Potentially] Edge Functions (if used beyond local config)
*   **Authentication:** [Clerk](https://clerk.com/) (handles user sign-up, sign-in, and profile management, syncs with Supabase DB)
*   **Deployment:** [**TODO: Specify deployment platform, e.g., Vercel, Netlify, Supabase Hosting, Cloudflare Pages?**]

## Repository Structure

```
.
├── .github/            # GitHub Actions workflows (if any)
├── .vscode/            # VS Code settings (optional)
├── dist/               # Build output directory (generated by `npm run build`)
├── functions/          # Contains Cloudflare Worker(s) (e.g., cors-proxy.js)
├── node_modules/       # Project dependencies (managed by npm/yarn/pnpm)
├── public/             # Static assets served directly
├── src/                # Main frontend application source code
│   ├── App.css         # Global App styles (minimal)
│   ├── App.tsx         # Root React component, sets up routing, providers
│   ├── components/     # Reusable UI components (mostly shadcn/ui based)
│   │   ├── ui/         # Raw shadcn/ui components
│   │   └── ...         # Custom composite components
│   ├── config/         # Application configuration files
│   ├── data/           # Static or mock data
│   ├── hooks/          # Custom React hooks (e.g., `useSupabaseAuth`)
│   ├── index.css       # Tailwind base styles and imports
│   ├── lib/            # Utility functions (e.g., `utils.ts`, `clerk-supabase.ts`)
│   ├── main.tsx        # Application entry point
│   ├── pages/          # Top-level page components for routes (e.g., Index, Admin, NotFound)
│   ├── services/       # API interaction logic (Supabase client calls)
│   ├── scripts/        # Utility scripts used within the app
│   ├── types/          # TypeScript type definitions
│   └── vite-env.d.ts   # Vite environment types
├── supabase/           # Supabase local development configuration
│   ├── migrations/     # Database schema migrations (managed by Supabase CLI)
│   ├── config.toml     # Supabase project configuration (local settings)
│   └── seed.sql        # [Optional] Seed data for local development (if used)
├── workers-site/       # Configuration/build related to Cloudflare Workers deployment (likely)
├── .env                # Local development environment variables (DO NOT COMMIT SENSITIVE KEYS)
├── .env.example        # Example environment variables (safe to commit)
├── .env.production     # Production environment variables (handle securely)
├── .gitignore          # Files and directories ignored by Git
├── AUTHENTICATION_GUIDE.md # Detailed guide on Clerk/Supabase auth setup
├── components.json     # shadcn/ui configuration
├── eslint.config.js    # ESLint configuration
├── index.html          # Main HTML entry point for Vite
├── package-lock.json   # Exact dependency versions
├── package.json        # Project metadata and dependencies
├── postcss.config.js   # PostCSS configuration (for Tailwind)
├── README.md           # This file
├── *.sql               # Various SQL scripts for database setup, fixes, seeding
├── SUPABASE_GUIDE.md   # Detailed guide on Supabase setup and usage
├── tailwind.config.ts  # Tailwind CSS configuration
├── TODO.md             # Project tasks and notes
├── tsconfig.app.json   # TypeScript configuration for the application
├── tsconfig.json       # Base TypeScript configuration
├── tsconfig.node.json  # TypeScript configuration for Node.js context (e.g., Vite config)
└── vite.config.ts      # Vite configuration file
```

## Key Components & Concepts

*   **Authentication (`Clerk` + `Supabase` + `App.tsx`):** Clerk handles frontend auth. `SupabaseAuthProvider` in `App.tsx` centrally manages the Clerk-Supabase link: it gets the Supabase JWT from Clerk, ensures the user exists in the Supabase `users` table, fetches the Supabase user profile, and provides this state (`token`, `supabaseUser`, `isAuthenticated`) via context. The simplified `useSupabaseAuth` hook consumes this context. RLS in Supabase uses the user ID from the token. See `AUTHENTICATION_GUIDE.md`.
*   **UI (`shadcn/ui` & `Tailwind`):** Components are primarily built using shadcn/ui, which provides unstyled primitives that are then styled using Tailwind CSS utility classes. Custom components are in `src/components/`, while base shadcn components are often added to `src/components/ui/`.
*   **Data Fetching (`Tanstack Query` + `use-queries.ts`):** Used for fetching/caching server state. Custom hooks in `use-queries.ts` abstract service calls. Includes optimized hooks like `useUserVotesForRequests` for bulk fetching user-specific data efficiently.
*   **Routing (`React Router`):** Defines application routes in `src/App.tsx`. Page components are located in `src/pages/`.
*   **Database (`Supabase`):** The Postgres database schema is managed via migrations in `supabase/migrations/`. The Supabase client is likely initialized and accessed via helper functions in `src/lib/` or `src/services/`. See `SUPABASE_GUIDE.md` for more.
*   **Environment Variables:** Configuration relies heavily on environment variables (`.env`, `.env.production`). Ensure you have a `.env` file set up locally based on `.env.example`. Sensitive production variables must be configured securely in the deployment environment.
*   **Cloudflare Worker (`functions/cors-proxy.js`):** A simple CORS proxy likely deployed to Cloudflare to handle preflight requests or bypass CORS limitations for certain external APIs (if any are used).

## Getting Started

1.  **Prerequisites:**
    *   [Node.js](https://nodejs.org/) (check `package.json` for specific version requirements, e.g., `"node": ">=18"`)
    *   [npm](https://www.npmjs.com/) (usually comes with Node.js)
    *   [Supabase CLI](https://supabase.com/docs/guides/cli)
    *   [Docker](https://www.docker.com/) (required by Supabase CLI for local development)
    *   A Clerk account and project set up.
    *   A Supabase account and project set up.

2.  **Clone the repository:**
    ```bash
    git clone <repository-url>
    cd gradjanskizahtevi
    ```

3.  **Install dependencies:**
    ```bash
    npm install
    ```

4.  **Set up Environment Variables:**
    *   Copy `.env.example` to `.env`.
    *   Fill in the required values in `.env`:
        *   Clerk Frontend API Key (`VITE_CLERK_PUBLISHABLE_KEY`)
        *   Supabase Project URL (`VITE_SUPABASE_URL`)
        *   Supabase Anon Key (`VITE_SUPABASE_ANON_KEY`)
        *   [Any other required variables listed in `.env.example`]
    *   Follow the steps in `AUTHENTICATION_GUIDE.md` and `SUPABASE_GUIDE.md` for detailed setup instructions regarding Clerk/Supabase integration keys and local development setup.

5.  **Start Supabase Local Development:**
    *   Make sure Docker is running.
    *   Link your local repository to your Supabase project (if not done already):
        ```bash
        supabase link --project-ref <your-supabase-project-id>
        # Follow prompts for database password
        ```
    *   Start the local Supabase services:
        ```bash
        supabase start
        ```
    *   Apply migrations (if needed, `supabase start` often does this):
        ```bash
        supabase db reset # Applies migrations and seed.sql (if exists)
        # OR
        # supabase migration up
        ```
    *   Note the local Supabase URL and Anon Key provided in the output and ensure they match your `.env` file.

6.  **Run the Development Server:**
    ```bash
    npm run dev
    ```
    This will start the Vite development server, typically available at `http://localhost:5173` (or the port specified by Vite).

## Key Scripts

*   `npm run dev`: Starts the Vite development server with hot reloading.
*   `npm run build`: Creates a production build in the `dist/` folder.
*   `npm run lint`: Runs ESLint to check for code quality issues.
*   `npm run preview`: Serves the production build locally for testing.
*   `supabase start`: Starts local Supabase services (database, auth, etc.).
*   `supabase stop`: Stops local Supabase services.
*   `supabase db reset`: Resets the local database, applies all migrations, and runs the seed script. **Warning:** This deletes all local data.
*   `supabase migration new <migration_name>`: Creates a new database migration file.
*   `supabase functions deploy <function_name>`: Deploys a Supabase Edge Function (if applicable).
*   `supabase functions serve`: Serves Supabase Edge Functions locally (if applicable).

## Further Reading

*   **Authentication:** See `AUTHENTICATION_GUIDE.md` for the centralized auth flow.
*   **Supabase:** See `SUPABASE_GUIDE.md` for Supabase details, including optimized data patterns.
*   **TODOs:** Check `TODO.md` for outstanding tasks or known issues.

## Contributing

[**TODO: Add guidelines for contributing, code style, branching strategy, PR process, etc.**]
